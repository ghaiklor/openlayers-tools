/*! OpenLayersTools - v1.0.0 - 2013-05-15
* http://ghaiklor.github.com/openlayers-tools/demo/
* Copyright (c) 2013 Obrezkov Evgen aka ghaiklor; Licensed MIT */
function OpenLayersTools(e){return this.BaseFunc=new BaseFunc(this),this.Console=new Console(this),this.Control=new Control(this),this.Layer=new Layer(this),this.Track=new Track(this),this.Vehicle=new Vehicle(this),this.MapOptions=this.BaseFunc.extendConfigFromDefault(e,defaultOptions.mapOptions),this.Map=new OpenLayers.Map(this.MapOptions),OpenLayers.ImgPath=this.MapOptions.imgPath,this.BaseFunc.centerMap(32.25366,48.51982,this.MapOptions.displayProjection),this}function BaseFunc(e){return this.parent=e,this}function Console(e){return this.debugMode=!0,this.parent=e,this}function Control(e){return this.parent=e,this.controls=[],this}function Layer(e){return this.parent=e,this}function Track(e){return this.parent=e,this}function Vehicle(e){return this.parent=e,this}OpenLayersTools.prototype={checkModule:function(){var e=[];for(var r in this)e.push(r+" exists!");e.push("OpenLayersTools Prototype exists! All is fine! :)"),this.Console.writeGroup("Checking modules of OpenLayersTools",e)}},BaseFunc.prototype={extendConfigFromDefault:function(e,r){if(null==e||void 0==e)return r;for(var n in r)r.hasOwnProperty(n)&&(void 0==e[n]||null==e[n])&&(e[n]=r[n]);return e},centerMap:function(e,r,n){var a=new OpenLayers.LonLat(e,r);return a.transform(new OpenLayers.Projection(n),this.parent.Map.getProjectionObject()),this.parent.Map.moveTo(a),!0},bindEventToObject:function(e,r){return void 0==e.events?(this.parent.Console.writeError("Func: bindEventToObject | Object don't have events callbacks!"),!1):(e.events.on(r),!0)},checkUndefined:function(e){return void 0==e||null==e||""==e||0==e.length},geometryToString:function(e){return""+e},stringToGeometry:function(e){return OpenLayers.Geometry.fromWKT(e)}},Console.prototype={writeInfo:function(e){console&&console.info(e)},writeDebug:function(e){console&&this.debugMode&&console.debug(e)},writeError:function(e){console&&console.error(e)},writeGroup:function(e,r){if(console){console.group(e);for(var n in r)r.hasOwnProperty(n)&&console.log(r[n]);console.groupEnd()}},writeWarning:function(e){console&&console.warn(e)}},Control.prototype={addControlToMapAndSaveForReturn:function(e,r){this.parent.Map.addControl(r),this.controls[e]=r},addControls:function(e){for(var r in e)if(e.hasOwnProperty(r)){if(void 0==e[r].controlType)return this.parent.Console.writeError("Func: addControls | You must specify controlType attribute in control parameters!"),!1;switch(e[r].controlType){case"ArgParser":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.ArgParser(e[r]));break;case"Attribution":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Attribution(e[r]));break;case"Button":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Button(e[r]));break;case"CacheRead":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.CacheRead(e[r]));break;case"CacheWrite":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.CacheWrite(e[r]));break;case"DragFeature":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.DragFeature(this.parent.Layer.getLayerByName(e[r].layerName),e[r]));break;case"DragPan":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.DragPan(e[r]));break;case"DrawFeature":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.DrawFeature(this.parent.Layer.getLayerByName(e[r].layerName),e[r].OpenLayersHandler,e[r]));break;case"EditingToolbar":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.EditingToolbar(this.parent.Layer.getLayerByName(e[r].layerName),e[r]));break;case"Geolocate":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Geolocate(e[r]));break;case"GetFeature":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.GetFeature(e[r]));break;case"Graticule":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Graticule(e[r]));break;case"KeyboardDefaults":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.KeyboardDefaults(e[r]));break;case"LayerSwitcher":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.LayerSwitcher(e[r]));break;case"Measure":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Measure(e[r].OpenLayersHandler,e[r]));break;case"ModifyFeature":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.ModifyFeature(this.parent.Layer.getLayerByName(e[r].layerName),e[r]));break;case"MousePosition":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.MousePosition(e[r]));break;case"Navigation":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Navigation(e[r]));break;case"NavigationHistory":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.NavigationHistory(e[r]));break;case"NavToolbar":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.NavToolbar(e[r]));break;case"OverviewMap":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.OverviewMap(e[r]));break;case"Pan":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Pan(e[r].direction,e[r]));break;case"Panel":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Panel(e[r]));break;case"PanPanel":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.PanPanel(e[r]));break;case"PanZoom":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.PanZoom(e[r]));break;case"PanZoomBar":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.PanZoomBar(e[r]));break;case"Permalink":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Permalink(e[r].element,e[r].base,e[r]));break;case"PinchZoom":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.PinchZoom(e[r]));break;case"Scale":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Scale(e[r]));break;case"ScaleLine":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.ScaleLine(e[r]));break;case"SelectFeature":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.SelectFeature(this.parent.Layer.getLayerByName(e[r].layerName),e[r]));break;case"SLDSelect":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.SLDSelect(e[r]));break;case"Snapping":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Snapping(e[r]));break;case"Split":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Split(e[r]));break;case"TouchNavigation":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.TouchNavigation(e[r]));break;case"TransformFeature":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.TransformFeature(this.parent.Layer.getLayerByName(e[r].layerName),e[r]));break;case"UTFGrid":break;case"WMSGetFeatureInfo":break;case"WMTSGetFeatureInfo":break;case"Zoom":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.Zoom(e[r]));break;case"ZoomBox":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.ZoomBox(e[r]));break;case"ZoomIn":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.ZoomIn(e[r]));break;case"ZoomOut":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.ZoomOut(e[r]));break;case"ZoomPanel":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.ZoomPanel(e[r]));break;case"ZoomToMaxExtent":this.addControlToMapAndSaveForReturn(r,new OpenLayers.Control.ZoomToMaxExtent(e[r]));break;default:this.parent.Console.writeWarning("Func: addControls | unexpected control type: "+r)}}return!0}};var defaultOptions={mapOptions:{div:"map",layers:[new OpenLayers.Layer.OSM],projection:"EPSG:900913",maxResolution:"156543.0339",maxExtent:[-18924313.432222,-15538711.094146,18924313.432222,15538711.094146],restrictedExtent:[-13358338.893333,-9608371.5085962,13358338.893333,9608371.5085962],numZoomLevels:"21",theme:"../css/open-layers.tidy.css",displayProjection:"EPSG:4326",imgPath:"../images/OpenLayers/",zoom:16},vehicleOptions:{label:"default",id:"default",display:"",projection:"EPSG:4326"},trackOptions:{id:"default",display:"",projection:"EPSG: 4326",minInterval:1e-6,maxInterval:.001}};Layer.prototype={addMap:function(e){var r=[];for(var n in e)if(e.hasOwnProperty(n))switch(e[n]){case"Google Physical":r.push(new OpenLayers.Layer.Google(n,{type:google.maps.MapTypeId.TERRAIN}));break;case"Google Streets":r.push(new OpenLayers.Layer.Google(n));break;case"Google Hybrid":r.push(new OpenLayers.Layer.Google(n,{type:google.maps.MapTypeId.HYBRID}));break;case"Google Satellite":r.push(new OpenLayers.Layer.Google(n,{type:google.maps.MapTypeId.SATELLITE}));break;case"Bing Aerial":r.push(new OpenLayers.Layer.Bing({name:n,type:"Aerial",key:"ArpBrjuWemAE1aBMYQUQp6e4PAy_hRI2L4yvUrRVacgaj-RQWJlqLn-LnkwgAuw9"}));break;case"Bing Aerial Labels":r.push(new OpenLayers.Layer.Bing({name:n,type:"AerialWithLabels",key:"ArpBrjuWemAE1aBMYQUQp6e4PAy_hRI2L4yvUrRVacgaj-RQWJlqLn-LnkwgAuw9"}));break;case"Bing Road":r.push(new OpenLayers.Layer.Bing({name:n,type:"Road",key:"ArpBrjuWemAE1aBMYQUQp6e4PAy_hRI2L4yvUrRVacgaj-RQWJlqLn-LnkwgAuw9"}));break;case"OSM":r.push(new OpenLayers.Layer.OSM);break;default:this.parent.Console.writeWarning("Func: addMap | Wrong layer type! Please check your parameters in function addMap!")}return 0!=r.length?(this.parent.Map.addLayers(r),!0):(this.parent.Console.writeError("Func: addMap | The count of layers is 0! Check parameters for function addMap!"),!1)},addVectorLayer:function(e,r){function n(e){return-1===["default","select","temporary"].indexOf(e)?(a.Console.writeWarning("Func: addVectorLayer | Wrong render intent for style! Check parameters!"),!1):(t[e]=new OpenLayers.Style(r.styleMap[e]),!0)}var a=this.parent;if(void 0==r.styleMap)return this.parent.Console.writeInfo("Func: addVectorLayer | StyleMap in config of addVectorLayer is empty! Set rules for StyleMap"),!1;var t=[];for(var o in r.styleMap)r.styleMap.hasOwnProperty(o)&&(n(o)||this.parent.Console.writeWarning("Func: addVectorLayer | Error in makeStyleMap! Check addVectorLayer parameters!"));return t=new OpenLayers.StyleMap(t),r.styleMap=t,this.parent.Map.addLayer(new OpenLayers.Layer.Vector(e,r)),!0},getLayerByName:function(e){var r=this.parent.Map.getLayersByName(e)[0];return void 0==r?(this.parent.Console.writeError("Func: getLayerByName | Layer "+e+" doesn't exists!"),!1):r},getLayersByName:function(e){var r=this.parent.Map.getLayersByName(e);return void 0==r?(this.parent.Console.writeError("Func: getLayersByName | Layer "+e+" doesn't exists!"),!1):r},getFeatureById:function(e,r){var n=this.getLayerByName(e);if(void 0==n)return this.parent.Console.writeError("Func: getFeatureById | Layer "+name+" doesn't exists!"),!1;if(void 0==n.features)return this.parent.Console.writeError("Func: getFeatureById | Layer "+name+" don't have features!"),!1;for(var a in n.features)if(n.features.hasOwnProperty(a)&&void 0!=n.features[a]&&n.features[a].attributes.id==r)return n.features[a];return!1},getFeaturesById:function(e,r){var n=this.getLayerByName(e),a=[];if(void 0==n)return this.parent.Console.writeError("Func: getFeaturesById | Layer "+name+" doesn't exists!"),!1;if(void 0==n.features)return this.parent.Console.writeError("Func: getFeaturesById | Layer "+name+" don't have features!"),!1;for(var t in n.features)n.features.hasOwnProperty(t)&&void 0!=n.features[t]&&n.features[t].attributes.id==r&&a.push(n.features[t]);return a}},Track.prototype={buildTrack:function(e,r,n){if(this.parent.BaseFunc.checkUndefined(r)||0==r.length)return this.parent.Console.writeError("Func: buildTrack | Coordinates is empty. Check parameters of function!"),!1;var a=this.parent.Layer.getLayerByName(e);if(this.parent.BaseFunc.checkUndefined(a)||!a)return this.parent.Console.writeError("Func: buildTrack | Layer "+e+"doesn't exists!"),!1;n=this.parent.BaseFunc.extendConfigFromDefault(n,defaultOptions.trackOptions);var t=[],o={longitude:0,latitude:0},s=null;for(var i in r)if(r.hasOwnProperty(i)){if(this.parent.BaseFunc.checkUndefined(r[i].longitude)||this.parent.BaseFunc.checkUndefined(r[i].latitude)){this.parent.Console.writeWarning("Func: buildTrack | Coordinates array have undefined coordinates! Please check array of coordinates in parameters of function!");continue}if(r[i].latitude!=o.latitude&&r[i].longitude!=o.longitude&&(Math.abs(r[i].longitude-o.longitude)>n.minInterval||Math.abs(r[i].latitude-o.latitude)>n.minInterval))if(Math.abs(r[i].longitude-o.longitude)<n.maxInterval||Math.abs(r[i].latitude-o.latitude)<n.maxInterval){o.longitude=r[i].longitude,o.latitude=r[i].latitude;var d=new OpenLayers.Geometry.Point(r[i].longitude,r[i].latitude);d.transform(new OpenLayers.Projection(n.projection),this.parent.Map.getProjectionObject()),t.push(d)}else o.longitude=r[i].longitude,o.latitude=r[i].latitude,s=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(t),n),a.addFeatures(s),t=[]}return 0!=t.length&&(s=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(t),n),a.addFeatures(s)),!0},removeTrack:function(e,r){var n=this.parent.Layer.getLayerByName(e);if(this.parent.BaseFunc.checkUndefined(n)||!n)return this.parent.Console.writeError("Func: removeTrack | Layer "+e+"does't exists!"),!1;var a=this.parent.Layer.getFeaturesById(e,r);if(this.parent.BaseFunc.checkUndefined(a)||!a)return this.parent.Console.writeError("Func: removeTrack | Layer "+e+"doesn't have features with id "+r),!1;for(var t in a)a.hasOwnProperty(t)&&n.removeFeatures(a[t]);return!0},visibilityTrack:function(e,r,n){var a=this.parent.Layer.getLayerByName(e);if(this.parent.BaseFunc.checkUndefined(a)||!a)return this.parent.Console.writeError("Func: removeTrack | Layer "+e+"does't exists!"),!1;var t=this.parent.Layer.getFeaturesById(e,r);if(this.parent.BaseFunc.checkUndefined(t)||!t)return this.parent.Console.writeError("Func: removeTrack | Layer "+e+"doesn't have features with id "+r),!1;for(var o in t)t.hasOwnProperty(o)&&(t[o].attributes.display=n?"":"none");return a.redraw(),!0}},Vehicle.prototype={addVehicle:function(e,r,n){n=this.parent.BaseFunc.extendConfigFromDefault(n,defaultOptions.vehicleOptions);var a=this.parent.Layer.getLayerByName(e);if(this.parent.BaseFunc.checkUndefined(a)||!a)return this.parent.Console.writeError("Func: addVehicle | Layer "+e+" doesn't exists!"),!1;var t=this.parent.Layer.getFeatureById(e,n.id);if(!this.parent.BaseFunc.checkUndefined(t)||t)return this.parent.Console.writeWarning("Func: addVehicle | Layer "+e+" already have feature with this ID: "+n.id+"!"),!1;var o=new OpenLayers.Geometry.Point(r.longitude,r.latitude);return o.transform(new OpenLayers.Projection(n.projection),new OpenLayers.Projection(this.parent.Map.getProjectionObject())),a.addFeatures(new OpenLayers.Feature.Vector(o,n)),!0},moveVehicle:function(e,r,n){var a=this.parent.Layer.getFeatureById(e,r);if(this.parent.BaseFunc.checkUndefined(a)||!a)return this.parent.Console.writeError("Func: moveVehicle | Feature with id "+r+" doesn't exists on "+e),!1;var t=new OpenLayers.LonLat(n.longitude,n.latitude);return t.transform(new OpenLayers.Projection(this.parent.MapOptions.displayProjection),this.parent.Map.getProjectionObject()),a.move(t),!0},removeVehicle:function(e,r){var n=this.parent.Layer.getLayerByName(e);if(this.parent.BaseFunc.checkUndefined(n)||!n)return this.parent.Console.writeError("Func: removeVehicle | Layer "+e+" doesn't exists!"),!1;var a=this.parent.Layer.getFeatureById(e,r);return this.parent.BaseFunc.checkUndefined(a)||!a?(this.parent.Console.writeError("Func: removeVehicle | Feature ID "+r+" undefined on "+e),!1):(n.removeFeatures(a),!0)},visibilityVehicle:function(e,r,n){var a=this.parent.Layer.getLayerByName(e);if(this.parent.BaseFunc.checkUndefined(a)||!a)return this.parent.Console.writeError("Func: removeVehicle | Layer "+e+" doesn't exists!"),!1;var t=this.parent.Layer.getFeatureById(e,r);return this.parent.BaseFunc.checkUndefined(t)||!t?(this.parent.Console.writeError("Func: removeVehicle | Feature ID "+r+" undefined on "+e),!1):(t.attributes.display=n?"":"none",a.redraw(),!0)}};